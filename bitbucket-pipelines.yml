pipelines:
  branches:
    master:
      - step:
          name: Bitbucket JDK 8 Ubuntu
          services:
            - docker
          script:
            - echo ${DOCKER_PASSWORD} | docker login --username ${DOCKER_USERNAME} --password-stdin
            - docker build -t atlassian/docker-release-maker:latest .
            - snyk auth a36f3f8d-b9b7-4eeb-b07b-079332ef9318
            - snyk container test atlassian/docker-release-maker:latest --severity-threshold=high
            - docker push atlassian/docker-release-maker:latest
  pull-requests:
    '**':
      - step:
          services:
            - docker
          script:
            - docker build -t "drm:dev" .
            - docker run --rm drm:dev py.test
